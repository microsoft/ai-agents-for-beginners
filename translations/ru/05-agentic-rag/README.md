<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "7622aa72f9e676e593339f5f694ecd7d",
  "translation_date": "2025-07-11T14:26:06+00:00",
  "source_file": "05-agentic-rag/README.md",
  "language_code": "ru"
}
-->
[![Agentic RAG](../../../05-agentic-rag/images/lesson-5-thumbnail.png)](https://youtu.be/WcjAARvdL7I?si=BCgwjwFb2yCkEhR9)

> _(Нажмите на изображение выше, чтобы посмотреть видео этого урока)_

# Агентный RAG

Этот урок предоставляет всесторонний обзор Агентного Восстановления с Дополненной Генерацией (Agentic RAG), нового подхода в ИИ, где большие языковые модели (LLM) самостоятельно планируют свои дальнейшие шаги, извлекая информацию из внешних источников. В отличие от статических паттернов "извлечение-затем-чтение", Агентный RAG включает итеративные вызовы LLM, перемежающиеся вызовами инструментов или функций и структурированными выводами. Система оценивает результаты, уточняет запросы, при необходимости вызывает дополнительные инструменты и продолжает этот цикл до достижения удовлетворительного решения.

## Введение

Этот урок охватывает

- **Понимание Агентного RAG:** Узнайте о новом подходе в ИИ, где большие языковые модели (LLM) самостоятельно планируют свои дальнейшие шаги, извлекая информацию из внешних источников данных.
- **Понимание Итеративного Стиля Maker-Checker:** Осознайте цикл итеративных вызовов LLM, перемежающихся вызовами инструментов или функций и структурированными выводами, предназначенными для улучшения корректности и обработки некорректных запросов.
- **Изучение Практических Применений:** Определите сценарии, где Агентный RAG проявляет себя, такие как среды с приоритетом на корректность, сложные взаимодействия с базами данных и расширенные рабочие процессы.

## Цели Обучения

После завершения этого урока вы будете знать, как/понимать:

- **Понимание Агентного RAG:** Узнайте о новом подходе в ИИ, где большие языковые модели (LLM) самостоятельно планируют свои дальнейшие шаги, извлекая информацию из внешних источников данных.
- **Итеративный Стиль Maker-Checker:** Осознайте концепцию цикла итеративных вызовов LLM, перемежающихся вызовами инструментов или функций и структурированными выводами, предназначенными для улучшения корректности и обработки некорректных запросов.
- **Владение Процессом Рассуждения:** Осознайте способность системы владеть своим процессом рассуждения, принимая решения о том, как подходить к проблемам, не полагаясь на предопределенные пути.
- **Рабочий Процесс:** Поймите, как агентная модель самостоятельно решает извлекать отчеты о рыночных трендах, идентифицировать данные конкурентов, коррелировать внутренние метрики продаж, синтезировать выводы и оценивать стратегию.
- **Итеративные Циклы, Интеграция Инструментов и Память:** Узнайте о зависимости системы от паттерна взаимодействия в цикле, поддерживающего состояние и память на протяжении шагов, чтобы избежать повторяющихся циклов и принимать обоснованные решения.
- **Обработка Режимов Отказа и Самокоррекция:** Изучите надежные механизмы самокоррекции системы, включая итерацию и повторные запросы, использование диагностических инструментов и обращение к человеческому надзору.
- **Границы Агентности:** Поймите ограничения Агентного RAG, сосредоточенные на автономии в рамках домена, зависимости от инфраструктуры и уважении к защитным мерам.
- **Практические Сценарии Использования и Ценность:** Определите сценарии, где Агентный RAG проявляет себя, такие как среды с приоритетом на корректность, сложные взаимодействия с базами данных и расширенные рабочие процессы.
- **Управление, Прозрачность и Доверие:** Узнайте о важности управления и прозрачности, включая объяснимое рассуждение, контроль предвзятости и человеческий надзор.

## Что такое Агентный RAG?

Агентное Восстановление с Дополненной Генерацией (Agentic RAG) — это новый подход в ИИ, где большие языковые модели (LLM) самостоятельно планируют свои дальнейшие шаги, извлекая информацию из внешних источников. В отличие от статических паттернов "извлечение-затем-чтение", Агентный RAG включает итеративные вызовы LLM, перемежающиеся вызовами инструментов или функций и структурированными выводами. Система оценивает результаты, уточняет запросы, при необходимости вызывает дополнительные инструменты и продолжает этот цикл до достижения удовлетворительного решения. Этот итеративный стиль "maker-checker" улучшает корректность, обрабатывает некорректные запросы и обеспечивает высокое качество результатов.

Система активно владеет своим процессом рассуждения, переписывая неудачные запросы, выбирая различные методы извлечения и интегрируя несколько инструментов — таких как векторный поиск в Azure AI Search, базы данных SQL или пользовательские API — перед тем, как окончательно ответить. Отличительной чертой агентной системы является ее способность владеть своим процессом рассуждения. Традиционные реализации RAG полагаются на предопределенные пути, но агентная система самостоятельно определяет последовательность шагов на основе качества найденной информации.

## Определение Агентного Восстановления с Дополненной Генерацией (Agentic RAG)

Агентное Восстановление с Дополненной Генерацией (Agentic RAG) — это новый подход в разработке ИИ, где LLM не только извлекают информацию из внешних источников данных, но и самостоятельно планируют свои дальнейшие шаги. В отличие от статических паттернов "извлечение-затем-чтение" или тщательно прописанных последовательностей подсказок, Агентный RAG включает цикл итеративных вызовов LLM, перемежающихся вызовами инструментов или функций и структурированными выводами. На каждом этапе система оценивает полученные результаты, решает, нужно ли уточнять запросы, вызывает дополнительные инструменты при необходимости и продолжает этот цикл до достижения удовлетворительного решения.

Этот итеративный стиль "maker-checker" предназначен для улучшения корректности, обработки некорректных запросов к структурированным базам данных (например, NL2SQL) и обеспечения сбалансированных, высококачественных результатов. Вместо того чтобы полагаться исключительно на тщательно разработанные цепочки подсказок, система активно владеет своим процессом рассуждения. Она может переписывать неудачные запросы, выбирать различные методы извлечения и интегрировать несколько инструментов — таких как векторный поиск в Azure AI Search, базы данных SQL или пользовательские API — перед тем, как окончательно ответить. Это устраняет необходимость в чрезмерно сложных оркестрационных фреймворках. Вместо этого относительно простой цикл "вызов LLM → использование инструмента → вызов LLM → …" может привести к сложным и обоснованным выводам.

![Основной Цикл Агентного RAG](../../../05-agentic-rag/images/agentic-rag-core-loop.png)

## Владение Процессом Рассуждения

Отличительной чертой, делающей систему "агентной", является ее способность владеть своим процессом рассуждения. Традиционные реализации RAG часто зависят от того, что люди заранее определяют путь для модели: цепочку мыслей, которая определяет, что извлекать и когда. Но когда система действительно агентная, она внутренне решает, как подходить к проблеме. Она не просто выполняет скрипт; она самостоятельно определяет последовательность шагов на основе качества найденной информации. Например, если ее просят создать стратегию запуска продукта, она не полагается исключительно на подсказку, которая описывает весь процесс исследования и принятия решений. Вместо этого агентная модель самостоятельно решает:

1. Извлечь текущие отчеты о рыночных трендах с помощью Bing Web Grounding
2. Идентифицировать соответствующие данные конкурентов с помощью Azure AI Search.
3. Коррелировать исторические внутренние метрики продаж с помощью Azure SQL Database.
4. Синтезировать выводы в целостную стратегию, организованную через Azure OpenAI Service.
5. Оценить стратегию на наличие пробелов или несоответствий, инициируя еще один раунд извлечения, если необходимо. Все эти шаги — уточнение запросов, выбор источников, итерация до "удовлетворенности" ответом — решаются моделью, а не предписываются человеком.

## Итеративные Циклы, Интеграция Инструментов и Память

![Архитектура Интеграции Инструментов](../../../05-agentic-rag/images/tool-integration.png)

Агентная система полагается на паттерн взаимодействия в цикле:

- **Первоначальный Вызов:** Цель пользователя (т.е. подсказка пользователя) представляется LLM.
- **Вызов Инструмента:** Если модель выявляет недостающую информацию или неоднозначные инструкции, она выбирает инструмент или метод извлечения — например, запрос к векторной базе данных (например, гибридный поиск Azure AI Search по частным данным) или структурированный SQL-запрос — для получения большего контекста.
- **Оценка и Уточнение:** После рассмотрения возвращенных данных модель решает, достаточно ли информации. Если нет, она уточняет запрос, пробует другой инструмент или корректирует свой подход.
- **Повторять до Удовлетворения:** Этот цикл продолжается до тех пор, пока модель не решит, что у нее достаточно ясности и доказательств для предоставления окончательного, хорошо обоснованного ответа.
- **Память и Состояние:** Поскольку система поддерживает состояние и память на протяжении шагов, она может вспоминать предыдущие попытки и их результаты, избегая повторяющихся циклов и принимая более обоснованные решения по мере продвижения.

Со временем это создает ощущение развивающегося понимания, позволяя модели справляться с комплексными, многошаговыми задачами без необходимости постоянного вмешательства человека или изменения подсказки.

## Обработка Режимов Отказа и Самокоррекция

Автономия Агентного RAG также включает надежные механизмы самокоррекции. Когда система сталкивается с тупиками — например, извлекая нерелевантные документы или сталкиваясь с некорректными запросами — она может:

- **Итерация и Повторный Запрос:** Вместо того чтобы возвращать низкокачественные ответы, модель пробует новые стратегии поиска, переписывает запросы к базе данных или рассматривает альтернативные наборы данных.
- **Использование Диагностических Инструментов:** Система может вызывать дополнительные функции, предназначенные для помощи в отладке шагов рассуждения или подтверждения корректности извлеченных данных. Инструменты, такие как Azure AI Tracing, будут важны для обеспечения надежной наблюдаемости и мониторинга.
- **Обращение к Человеческому Надзору:** Для высокорисковых или повторяющихся неудачных сценариев модель может сигнализировать о неуверенности и запрашивать руководство человека. Как только человек предоставляет корректирующую обратную связь, модель может учесть этот урок в будущем.

Этот итеративный и динамичный подход позволяет модели постоянно улучшаться, гарантируя, что она не просто одноразовая система, а система, которая учится на своих ошибках в течение данной сессии.

![Механизм Самокоррекции](../../../05-agentic-rag/images/self-correction.png)

## Границы Агентности

Несмотря на свою автономию в рамках задачи, Агентный RAG не является аналогом Искусственного Общего Интеллекта. Его "агентные" возможности ограничены инструментами, источниками данных и политиками, предоставленными разработчиками. Он не может изобретать собственные инструменты или выходить за пределы установленных доменных границ. Скорее, он превосходно справляется с динамической оркестрацией имеющихся ресурсов. Ключевые отличия от более продвинутых форм ИИ включают:

1. **Автономия в рамках домена:** Системы Агентного RAG сосредоточены на достижении целей, определенных пользователем, в известном домене, используя такие стратегии, как переписывание запросов или выбор инструментов для улучшения результатов.
2. **Зависимость от инфраструктуры:** Возможности системы зависят от инструментов и данных, интегрированных разработчиками. Она не может превзойти эти границы без вмешательства человека.
3. **Уважение к защитным мерам:** Этические руководства, правила соблюдения и бизнес-политики остаются очень важными. Свобода агента всегда ограничена мерами безопасности и механизмами надзора (надеемся?).

## Практические Сценарии Использования и Ценность

Агентный RAG проявляет себя в сценариях, требующих итеративного уточнения и точности:

1. **Среды с приоритетом на корректность:** В проверках на соответствие, анализе нормативных актов или юридических исследованиях агентная модель может многократно проверять факты, консультироваться с несколькими источниками и переписывать запросы, пока не предоставит тщательно проверенный ответ.
2. **Сложные взаимодействия с базами данных:** При работе со структурированными данными, где запросы могут часто терпеть неудачу или требовать корректировки, система может самостоятельно уточнять свои запросы, используя Azure SQL или Microsoft Fabric OneLake, гарантируя, что окончательное извлечение соответствует намерениям пользователя.
3. **Расширенные рабочие процессы:** Длительные сессии могут развиваться по мере появления новой информации. Агентный RAG может постоянно интегрировать новые данные, изменяя стратегии по мере того, как он узнает больше о проблемной области.

## Управление, Прозрачность и Доверие

По мере того как эти системы становятся более автономными в своих рассуждениях, управление и прозрачность становятся ключевыми:

- **Объяснимое Рассуждение:** Модель может предоставить журнал запросов, которые она сделала, источников, которые она проконсультировала, и шагов рассуждения, которые она предприняла для достижения своего вывода. Инструменты, такие как Azure AI Content Safety и Azure AI Tracing / GenAIOps, могут помочь поддерживать прозрачность и снижать риски.
- **Контроль Предвзятости и Сбалансированное Извлечение:** Разработчики могут настраивать стратегии извлечения, чтобы гарантировать, что учитываются сбалансированные, репрезентативные источники данных, и регулярно проверять выводы, чтобы обнаруживать предвзятость или искаженные паттерны, используя пользовательские модели для продвинутых организаций в области науки о данных, использующих Azure Machine Learning.
- **Человеческий Надзор и Соответствие:** Для чувствительных задач человеческий обзор остается необходимым. Агентный RAG не заменяет человеческое суждение в высокорисковых решениях — он дополняет его, предоставляя более тщательно проверенные варианты.

Наличие инструментов, предоставляющих четкий отчет о действиях, является важным. Без них отладка многошагового процесса может быть очень сложной. См. следующий пример от Literal AI (компания, стоящая за Chainlit) для выполнения агента:

![Пример Выполнения Агента](../../../05-agentic-rag/images/AgentRunExample.png)

![Пример Выполнения Агента 2](../../../05-agentic-rag/images/AgentRunExample2.png)

## Заключение

Агентный RAG представляет собой естественную эволюцию в том, как системы ИИ справляются с комплексными, насыщенными данными задачами. Применяя паттерн взаимодействия в цикле, самостоятельно выбирая инструменты и уточняя запросы до достижения высококачественного результата, система выходит за рамки статического следования подсказкам и становится более адаптивным, осведомленным о контексте решателем. Хотя она все еще ограничена инфраструктурами и этическими руководствами, определенными человеком, эти агентные возможности позволяют более богатые, более динамичные и, в конечном итоге, более полезные взаимодействия ИИ как для предприятий, так и для конечных пользователей.

## Дополнительные Ресурсы

- <a href="https://learn.microsoft.com/training/modules/use-own-data-azure-openai" target="_blank">Реализация Восстановления с Дополненной Генерацией (RAG) с помощью Azure OpenAI Service: Узнайте, как использовать собственные данные с Azure OpenAI Service. Этот модуль Microsoft Learn предоставляет всестороннее руководство по реализации RAG
</a>
- <a href="https://learn.microsoft.com/azure/ai-studio/concepts/evaluation-approach-gen-ai" target="_blank">Оценка приложений генеративного ИИ с Azure AI Foundry: В этой статье рассматривается оценка и сравнение моделей на общедоступных наборах данных, включая приложения Agentic AI и архитектуры RAG</a>
- <a href="https://weaviate.io/blog/what-is-agentic-rag" target="_blank">Что такое Agentic RAG | Weaviate</a>
- <a href="https://ragaboutit.com/agentic-rag-a-complete-guide-to-agent-based-retrieval-augmented-generation/" target="_blank">Agentic RAG: Полное руководство по генерации с дополнением на основе агентов – Новости от generation RAG</a>
- <a href="https://huggingface.co/learn/cookbook/agent_rag" target="_blank">Agentic RAG: ускорьте ваш RAG с помощью реформулирования запросов и самозапросов! Hugging Face Open-Source AI Cookbook</a>
- <a href="https://youtu.be/aQ4yQXeB1Ss?si=2HUqBzHoeB5tR04U" target="_blank">Добавление агентных слоев в RAG</a>
- <a href="https://www.youtube.com/watch?v=zeAyuLc_f3Q&t=244s" target="_blank">Будущее помощников по знаниям: Джерри Лю</a>
- <a href="https://www.youtube.com/watch?v=AOSjiXP1jmQ" target="_blank">Как построить системы Agentic RAG</a>
- <a href="https://ignite.microsoft.com/sessions/BRK102?source=sessions" target="_blank">Использование службы агентов Azure AI Foundry для масштабирования ваших ИИ-агентов</a>

### Научные статьи

- <a href="https://arxiv.org/abs/2303.17651" target="_blank">2303.17651 Self-Refine: Итеративное уточнение с самокоррекцией</a>
- <a href="https://arxiv.org/abs/2303.11366" target="_blank">2303.11366 Reflexion: Языковые агенты с вербальным обучением с подкреплением</a>
- <a href="https://arxiv.org/abs/2305.11738" target="_blank">2305.11738 CRITIC: Большие языковые модели могут самокорректироваться с помощью инструментального критического анализа</a>
- <a href="https://arxiv.org/abs/2501.09136" target="_blank">2501.09136 Агентная генерация с дополнением извлечения: Обзор Agentic RAG</a>

## Предыдущий урок

[Шаблон использования инструментов](../04-tool-use/README.md)

## Следующий урок

[Создание надежных ИИ-агентов](../06-building-trustworthy-agents/README.md)

**Отказ от ответственности**:  
Этот документ был переведен с помощью службы автоматического перевода [Co-op Translator](https://github.com/Azure/co-op-translator). Хотя мы стремимся к точности, пожалуйста, имейте в виду, что автоматические переводы могут содержать ошибки или неточности. Оригинальный документ на его родном языке следует считать авторитетным источником. Для получения критически важной информации рекомендуется профессиональный перевод человеком. Мы не несем ответственности за любые недоразумения или неправильные толкования, возникающие в результате использования этого перевода.