<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "5cc6836626047aa055e8960c8484a7d0",
  "translation_date": "2025-08-21T13:38:05+00:00",
  "source_file": "11-mcp/code_samples/mcp-agents/README.md",
  "language_code": "bg"
}
-->
# –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ —Å–∏—Å—Ç–µ–º–∏ –∑–∞ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∏ —Å MCP

> –ù–∞–∫—Ä–∞—Ç–∫–æ - –ú–æ–∂–µ—Ç–µ –ª–∏ –¥–∞ –∏–∑–≥—Ä–∞–¥–∏—Ç–µ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∏ —Å MCP? –î–∞!

MCP –∑–Ω–∞—á–∏—Ç–µ–ª–Ω–æ —Å–µ —Ä–∞–∑–≤–∏ –æ—Ç–≤—ä–¥ –ø—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–∞—Ç–∞ —Å–∏ —Ü–µ–ª ‚Äû–æ—Å–∏–≥—É—Ä—è–≤–∞–Ω–µ –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞ LLMs‚Äú. –° –ø–æ—Å–ª–µ–¥–Ω–∏—Ç–µ –ø–æ–¥–æ–±—Ä–µ–Ω–∏—è, –≤–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ [–≤—ä–∑–æ–±–Ω–æ–≤—è–µ–º–∏ –ø–æ—Ç–æ—Ü–∏](https://modelcontextprotocol.io/docs/concepts/transports#resumability-and-redelivery), [–µ–ª–∏—Ü–∏—Ç–∞—Ü–∏—è](https://modelcontextprotocol.io/specification/2025-06-18/client/elicitation), [—Å–µ–º–ø–ª–∏—Ä–∞–Ω–µ](https://modelcontextprotocol.io/specification/2025-06-18/client/sampling) –∏ –∏–∑–≤–µ—Å—Ç–∏—è ([–Ω–∞–ø—Ä–µ–¥—ä–∫](https://modelcontextprotocol.io/specification/2025-06-18/basic/utilities/progress) –∏ [—Ä–µ—Å—É—Ä—Å–∏](https://modelcontextprotocol.io/specification/2025-06-18/schema#resourceupdatednotification)), MCP –≤–µ—á–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è —Å—Ç–∞–±–∏–ª–Ω–∞ –æ—Å–Ω–æ–≤–∞ –∑–∞ –∏–∑–≥—Ä–∞–∂–¥–∞–Ω–µ –Ω–∞ —Å–ª–æ–∂–Ω–∏ —Å–∏—Å—Ç–µ–º–∏ –∑–∞ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∏.

## –ó–∞–±–ª—É–¥–∞—Ç–∞ –∑–∞ –∞–≥–µ–Ω—Ç/–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

–° —É–≤–µ–ª–∏—á–∞–≤–∞–Ω–µ—Ç–æ –Ω–∞ –±—Ä–æ—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏—Ü–∏, –∫–æ–∏—Ç–æ –∏–∑—Å–ª–µ–¥–≤–∞—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —Å –∞–≥–µ–Ω—Ç–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (—Ä–∞–±–æ—Ç—è—Ç –∑–∞ –¥—ä–ª–≥–∏ –ø–µ—Ä–∏–æ–¥–∏, –º–æ–∂–µ –¥–∞ –∏–∑–∏—Å–∫–≤–∞—Ç –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–µ–Ω –≤—Ö–æ–¥ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ –∏ –¥—Ä.), —á–µ—Å—Ç–æ —Å—Ä–µ—â–∞–Ω–æ –ø–æ–≥—Ä–µ—à–Ω–æ —Å—Ö–≤–∞—â–∞–Ω–µ –µ, —á–µ MCP –Ω–µ –µ –ø–æ–¥—Ö–æ–¥—è—â, –≥–ª–∞–≤–Ω–æ –∑–∞—â–æ—Ç–æ —Ä–∞–Ω–Ω–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–∏ –∑–∞ –Ω–µ–≥–æ–≤–∏—è –ø—Ä–∏–º–∏—Ç–∏–≤–µ–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–µ —Ñ–æ–∫—É—Å–∏—Ä–∞—Ö–∞ –≤—ä—Ä—Ö—É –ø—Ä–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏ –Ω–∞ –∑–∞—è–≤–∫–∞-–æ—Ç–≥–æ–≤–æ—Ä.

–¢–æ–≤–∞ –≤—ä–∑–ø—Ä–∏—è—Ç–∏–µ –µ –æ—Å—Ç–∞—Ä—è–ª–æ. –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è—Ç–∞ –Ω–∞ MCP –∑–Ω–∞—á–∏—Ç–µ–ª–Ω–æ —Å–µ –ø–æ–¥–æ–±—Ä–∏ –ø—Ä–µ–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ç–µ –º–µ—Å–µ—Ü–∏ —Å –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –∫–æ–∏—Ç–æ –∑–∞—Ç–≤–∞—Ä—è—Ç –ø—Ä–æ–ø–∞—Å—Ç—Ç–∞ –∑–∞ –∏–∑–≥—Ä–∞–∂–¥–∞–Ω–µ –Ω–∞ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–æ –∞–≥–µ–Ω—Ç–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

- **–ü–æ—Ç–æ—á–Ω–æ –ø—Ä–µ–¥–∞–≤–∞–Ω–µ –∏ —á–∞—Å—Ç–∏—á–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏**: –ê–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ
- **–í—ä–∑–æ–±–Ω–æ–≤—è–µ–º–æ—Å—Ç**: –ö–ª–∏–µ–Ω—Ç–∏—Ç–µ –º–æ–≥–∞—Ç –¥–∞ —Å–µ —Å–≤—ä—Ä–∂–∞—Ç –æ—Ç–Ω–æ–≤–æ –∏ –¥–∞ –ø—Ä–æ–¥—ä–ª–∂–∞—Ç —Å–ª–µ–¥ –ø—Ä–µ–∫—ä—Å–≤–∞–Ω–µ
- **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç**: –†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –æ—Ü–µ–ª—è–≤–∞—Ç —Å–ª–µ–¥ —Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä —á—Ä–µ–∑ –≤—Ä—ä–∑–∫–∏ –∫—ä–º —Ä–µ—Å—É—Ä—Å–∏)
- **–ú–Ω–æ–≥–æ—Ö–æ–¥–æ–≤–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è**: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–µ–Ω –≤—Ö–æ–¥ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ —á—Ä–µ–∑ –µ–ª–∏—Ü–∏—Ç–∞—Ü–∏—è –∏ —Å–µ–º–ø–ª–∏—Ä–∞–Ω–µ

–¢–µ–∑–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥–∞—Ç –¥–∞ –±—ä–¥–∞—Ç –∫–æ–º–±–∏–Ω–∏—Ä–∞–Ω–∏ –∑–∞ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ —Å–ª–æ–∂–Ω–∏ –∞–≥–µ–Ω—Ç–Ω–∏ –∏ –º—É–ª—Ç–∏–∞–≥–µ–Ω—Ç–Ω–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤—Å–∏—á–∫–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏ –≤—ä—Ä—Ö—É MCP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.

–ó–∞ —Å–ø—Ä–∞–≤–∫–∞, —â–µ –Ω–∞—Ä–∏—á–∞–º–µ –∞–≥–µ–Ω—Ç ‚Äû–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç‚Äú, –∫–æ–π—Ç–æ –µ –¥–æ—Å—Ç—ä–ø–µ–Ω –Ω–∞ MCP —Å—ä—Ä–≤—ä—Ä. –¢–æ–≤–∞ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞ –Ω–∞–ª–∏—á–∏–µ—Ç–æ –Ω–∞ —Ö–æ—Å—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ–µ—Ç–æ —Ä–µ–∞–ª–∏–∑–∏—Ä–∞ MCP –∫–ª–∏–µ–Ω—Ç, —É—Å—Ç–∞–Ω–æ–≤—è–≤–∞ —Å–µ—Å–∏—è —Å—ä—Å —Å—ä—Ä–≤—ä—Ä–∞ –∏ –º–æ–∂–µ –¥–∞ –∏–∑–≤–∏–∫–≤–∞ –∞–≥–µ–Ω—Ç–∞.

## –ö–∞–∫–≤–æ –ø—Ä–∞–≤–∏ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ‚Äû–∞–≥–µ–Ω—Ç–µ–Ω‚Äú?

–ü—Ä–µ–¥–∏ –¥–∞ –ø—Ä–µ–º–∏–Ω–µ–º –∫—ä–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ç–∞, –Ω–µ–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∏–º –∫–∞–∫–≤–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∏ –∑–∞ –ø–æ–¥–¥—Ä—ä–∂–∫–∞ –Ω–∞ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∏ –∞–≥–µ–Ω—Ç–∏.

> –©–µ –¥–µ—Ñ–∏–Ω–∏—Ä–∞–º–µ –∞–≥–µ–Ω—Ç –∫–∞—Ç–æ —Å—É–±–µ–∫—Ç, –∫–æ–π—Ç–æ –º–æ–∂–µ –¥–∞ —Ä–∞–±–æ—Ç–∏ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ –∑–∞ –ø—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∏ –ø–µ—Ä–∏–æ–¥–∏, —Å–ø–æ—Å–æ–±–µ–Ω –¥–∞ —Å–µ —Å–ø—Ä–∞–≤—è —Å—ä—Å —Å–ª–æ–∂–Ω–∏ –∑–∞–¥–∞—á–∏, –∫–æ–∏—Ç–æ –º–æ–∂–µ –¥–∞ –∏–∑–∏—Å–∫–≤–∞—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏–ª–∏ –∫–æ—Ä–µ–∫—Ü–∏–∏ –≤—ä–∑ –æ—Å–Ω–æ–≤–∞ –Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞ –≤—Ä—ä–∑–∫–∞ –≤ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ.

### 1. –ü–æ—Ç–æ—á–Ω–æ –ø—Ä–µ–¥–∞–≤–∞–Ω–µ –∏ —á–∞—Å—Ç–∏—á–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏

–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∏—Ç–µ –º–æ–¥–µ–ª–∏ –Ω–∞ –∑–∞—è–≤–∫–∞-–æ—Ç–≥–æ–≤–æ—Ä –Ω–µ —Ä–∞–±–æ—Ç—è—Ç –∑–∞ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∏ –∑–∞–¥–∞—á–∏. –ê–≥–µ–Ω—Ç–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è—Ç:

- –ê–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞ –≤ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ
- –ú–µ–∂–¥–∏–Ω–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏

**–ü–æ–¥–¥—Ä—ä–∂–∫–∞ –æ—Ç MCP**: –ò–∑–≤–µ—Å—Ç–∏—è—Ç–∞ –∑–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ä–µ—Å—É—Ä—Å–∏ –ø–æ–∑–≤–æ–ª—è–≤–∞—Ç –ø–æ—Ç–æ—á–Ω–æ –ø—Ä–µ–¥–∞–≤–∞–Ω–µ –Ω–∞ —á–∞—Å—Ç–∏—á–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏, –≤—ä–ø—Ä–µ–∫–∏ —á–µ —Ç–æ–≤–∞ –∏–∑–∏—Å–∫–≤–∞ –≤–Ω–∏–º–∞—Ç–µ–ª–µ–Ω –¥–∏–∑–∞–π–Ω, –∑–∞ –¥–∞ —Å–µ –∏–∑–±–µ–≥–Ω–∞—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∏ —Å –º–æ–¥–µ–ª–∞ 1:1 –∑–∞—è–≤–∫–∞/–æ—Ç–≥–æ–≤–æ—Ä –Ω–∞ JSON-RPC.

| –§—É–Ω–∫—Ü–∏—è                     | –ü—Ä–∏–º–µ—Ä –∑–∞ —É–ø–æ—Ç—Ä–µ–±–∞                                                                                                                                                                       | –ü–æ–¥–¥—Ä—ä–∂–∫–∞ –æ—Ç MCP                                                                          |
| --------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| –ê–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞   | –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –∑–∞—è–≤—è–≤–∞ –∑–∞–¥–∞—á–∞ –∑–∞ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –∫–æ–¥–æ–≤–∞ –±–∞–∑–∞. –ê–≥–µ–Ω—Ç—ä—Ç –ø—Ä–µ–¥–∞–≤–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞: ‚Äû10% - –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏... 25% - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ TypeScript —Ñ–∞–π–ª–æ–≤–µ... 50% - –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –∏–º–ø–æ—Ä—Ç–∏...‚Äú | ‚úÖ –ò–∑–≤–µ—Å—Ç–∏—è –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫                                                                    |
| –ß–∞—Å—Ç–∏—á–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏          | –ó–∞–¥–∞—á–∞ ‚Äû–ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∫–Ω–∏–≥–∞‚Äú –ø—Ä–µ–¥–∞–≤–∞ —á–∞—Å—Ç–∏—á–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏, –Ω–∞–ø—Ä. 1) –û—á–µ—Ä—Ç–∞–Ω–∏–µ –Ω–∞ —Å—é–∂–µ—Ç–Ω–∞—Ç–∞ –ª–∏–Ω–∏—è, 2) –°–ø–∏—Å—ä–∫ —Å –≥–ª–∞–≤–∏, 3) –í—Å—è–∫–∞ –≥–ª–∞–≤–∞, –∫–æ–≥–∞—Ç–æ –µ –∑–∞–≤—ä—Ä—à–µ–Ω–∞. –•–æ—Å—Ç—ä—Ç –º–æ–∂–µ –¥–∞ –∏–Ω—Å–ø–µ–∫—Ç–∏—Ä–∞, –∞–Ω—É–ª–∏—Ä–∞ –∏–ª–∏ –ø—Ä–µ–Ω–∞—Å–æ—á–∏ –Ω–∞ –≤—Å–µ–∫–∏ –µ—Ç–∞–ø. | ‚úÖ –ò–∑–≤–µ—Å—Ç–∏—è—Ç–∞ –º–æ–≥–∞—Ç –¥–∞ –±—ä–¥–∞—Ç ‚Äû—Ä–∞–∑—à–∏—Ä–µ–Ω–∏‚Äú, –∑–∞ –¥–∞ –≤–∫–ª—é—á–≤–∞—Ç —á–∞—Å—Ç–∏—á–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏, –≤–∏–∂—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤ PR 383, 776 |

<div align="center" style="font-style: italic; font-size: 0.95em; margin-bottom: 0.5em;">
<strong>–§–∏–≥—É—Ä–∞ 1:</strong> –¢–∞–∑–∏ –¥–∏–∞–≥—Ä–∞–º–∞ –∏–ª—é—Å—Ç—Ä–∏—Ä–∞ –∫–∞–∫ MCP –∞–≥–µ–Ω—Ç –ø—Ä–µ–¥–∞–≤–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞ –≤ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ –∏ —á–∞—Å—Ç–∏—á–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∫—ä–º —Ö–æ—Å—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∞ –∑–∞–¥–∞—á–∞, –ø–æ–∑–≤–æ–ª—è–≤–∞–π–∫–∏ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è –¥–∞ —Å–ª–µ–¥–∏ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ—Ç–æ –≤ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ.
</div>

```mermaid
sequenceDiagram
    participant User
    participant Host as Host App<br/>(MCP Client)
    participant Server as MCP Server<br/>(Agent Tool)

    User->>Host: Start long task
    Host->>Server: Call agent_tool()

    loop Progress Updates
        Server-->>Host: Progress + partial results
        Host-->>User: Stream updates
    end

    Server-->>Host: ‚úÖ Final result
    Host-->>User: Complete
```

### 2. –í—ä–∑–æ–±–Ω–æ–≤—è–µ–º–æ—Å—Ç

–ê–≥–µ–Ω—Ç–∏—Ç–µ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ —Å–ø—Ä–∞–≤—è—Ç —Å –ø—Ä–µ–∫—ä—Å–≤–∞–Ω–∏—è –Ω–∞ –º—Ä–µ–∂–∞—Ç–∞ –±–µ–∑–ø—Ä–æ–±–ª–µ–º–Ω–æ:

- –°–≤—ä—Ä–∑–≤–∞–Ω–µ –æ—Ç–Ω–æ–≤–æ —Å–ª–µ–¥ –ø—Ä–µ–∫—ä—Å–≤–∞–Ω–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞
- –ü—Ä–æ–¥—ä–ª–∂–∞–≤–∞–Ω–µ –æ—Ç –º—è—Å—Ç–æ—Ç–æ, –∫—ä–¥–µ—Ç–æ —Å–∞ —Å–ø—Ä–µ–ª–∏ (–ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ —Å—ä–æ–±—â–µ–Ω–∏—è)

**–ü–æ–¥–¥—Ä—ä–∂–∫–∞ –æ—Ç MCP**: MCP StreamableHTTP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–Ω–µ—Å –ø–æ–¥–¥—ä—Ä–∂–∞ –≤—ä–∑–æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Å–µ—Å–∏—è –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ —Å—ä–æ–±—â–µ–Ω–∏—è —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∏ –Ω–∞ —Å–µ—Å–∏–∏ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏ —Å—ä–±–∏—Ç–∏—è. –í–∞–∂–Ω–∞ –±–µ–ª–µ–∂–∫–∞ —Ç—É–∫ –µ, —á–µ —Å—ä—Ä–≤—ä—Ä—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ —Ä–µ–∞–ª–∏–∑–∏—Ä–∞ EventStore, –∫–æ–π—Ç–æ –ø–æ–∑–≤–æ–ª—è–≤–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ —Å—ä–±–∏—Ç–∏—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å–≤—ä—Ä–∑–≤–∞–Ω–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞.  
–ò–º–∞–π—Ç–µ –ø—Ä–µ–¥–≤–∏–¥, —á–µ –∏–º–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç –æ–±—â–Ω–æ—Å—Ç—Ç–∞ (PR #975), –∫–æ–µ—Ç–æ –∏–∑—Å–ª–µ–¥–≤–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ-–Ω–µ–∑–∞–≤–∏—Å–∏–º–∏ –≤—ä–∑–æ–±–Ω–æ–≤—è–µ–º–∏ –ø–æ—Ç–æ—Ü–∏.

| –§—É–Ω–∫—Ü–∏—è       | –ü—Ä–∏–º–µ—Ä –∑–∞ —É–ø–æ—Ç—Ä–µ–±–∞                                                                                                                                                   | –ü–æ–¥–¥—Ä—ä–∂–∫–∞ –æ—Ç MCP                                                                |
| ------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- |
| –í—ä–∑–æ–±–Ω–æ–≤—è–µ–º–æ—Å—Ç | –ö–ª–∏–µ–Ω—Ç—ä—Ç —Å–µ –ø—Ä–µ–∫—ä—Å–≤–∞ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∞ –∑–∞–¥–∞—á–∞. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å–≤—ä—Ä–∑–≤–∞–Ω–µ —Å–µ—Å–∏—è—Ç–∞ —Å–µ –≤—ä–∑–æ–±–Ω–æ–≤—è–≤–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∏ –ø—Ä–æ–ø—É—Å–Ω–∞—Ç–∏ —Å—ä–±–∏—Ç–∏—è, –ø—Ä–æ–¥—ä–ª–∂–∞–≤–∞–π–∫–∏ –±–µ–∑–ø—Ä–æ–±–ª–µ–º–Ω–æ –æ—Ç –º—è—Å—Ç–æ—Ç–æ, –∫—ä–¥–µ—Ç–æ –µ —Å–ø—Ä—è–ª–∞. | ‚úÖ StreamableHTTP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∏ –Ω–∞ —Å–µ—Å–∏–∏, –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ —Å—ä–±–∏—Ç–∏—è –∏ EventStore |

<div align="center" style="font-style: italic; font-size: 0.95em; margin-bottom: 0.5em;">
<strong>–§–∏–≥—É—Ä–∞ 2:</strong> –¢–∞–∑–∏ –¥–∏–∞–≥—Ä–∞–º–∞ –ø–æ–∫–∞–∑–≤–∞ –∫–∞–∫ StreamableHTTP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—ä—Ç –∏ EventStore –Ω–∞ MCP –ø–æ–∑–≤–æ–ª—è–≤–∞—Ç –±–µ–∑–ø—Ä–æ–±–ª–µ–º–Ω–æ –≤—ä–∑–æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Å–µ—Å–∏—è—Ç–∞: –∞–∫–æ –∫–ª–∏–µ–Ω—Ç—ä—Ç —Å–µ –ø—Ä–µ–∫—ä—Å–Ω–µ, —Ç–æ–π –º–æ–∂–µ –¥–∞ —Å–µ —Å–≤—ä—Ä–∂–µ –æ—Ç–Ω–æ–≤–æ –∏ –¥–∞ –ø–æ–≤—Ç–æ—Ä–∏ –ø—Ä–æ–ø—É—Å–Ω–∞—Ç–∏—Ç–µ —Å—ä–±–∏—Ç–∏—è, –ø—Ä–æ–¥—ä–ª–∂–∞–≤–∞–π–∫–∏ –∑–∞–¥–∞—á–∞—Ç–∞ –±–µ–∑ –∑–∞–≥—É–±–∞ –Ω–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫.
</div>

```mermaid
sequenceDiagram
    participant User
    participant Host as Host App<br/>(MCP Client)
    participant Server as MCP Server<br/>(Agent Tool)
    participant Store as Event Store

    User->>Host: Start task
    Host->>Server: Call tool [session: abc123]
    Server->>Store: Save events

    Note over Host,Server: üí• Connection lost

    Host->>Server: Reconnect [session: abc123]
    Store-->>Server: Replay events
    Server-->>Host: Catch up + continue
    Host-->>User: ‚úÖ Complete
```

### 3. –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç

–î—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∏—Ç–µ –∞–≥–µ–Ω—Ç–∏ —Å–µ –Ω—É–∂–¥–∞—è—Ç –æ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ:

- –†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –æ—Ü–µ–ª—è–≤–∞—Ç —Å–ª–µ–¥ —Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞
- –°—Ç–∞—Ç—É—Å—ä—Ç –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –∏–∑–≤–ª–µ—á–µ–Ω –∏–∑–≤—ä–Ω —Å–µ—Å–∏—è—Ç–∞
- –ü—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞ –º–µ–∂–¥—É —Å–µ—Å–∏–∏—Ç–µ

**–ü–æ–¥–¥—Ä—ä–∂–∫–∞ –æ—Ç MCP**: MCP –≤–µ—á–µ –ø–æ–¥–¥—ä—Ä–∂–∞ —Ç–∏–ø –≤—Ä—ä—â–∞–Ω–µ –Ω–∞ –≤—Ä—ä–∑–∫–∞ –∫—ä–º —Ä–µ—Å—É—Ä—Å –∑–∞ –∏–∑–≤–∏–∫–≤–∞–Ω–∏—è –Ω–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏. –î–Ω–µ—Å –≤—ä–∑–º–æ–∂–µ–Ω –º–æ–¥–µ–ª –µ –¥–∞ —Å–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ–π—Ç–æ —Å—ä–∑–¥–∞–≤–∞ —Ä–µ—Å—É—Ä—Å –∏ –≤–µ–¥–Ω–∞–≥–∞ –≤—Ä—ä—â–∞ –≤—Ä—ä–∑–∫–∞ –∫—ä–º —Ä–µ—Å—É—Ä—Å. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ä—Ç –º–æ–∂–µ –¥–∞ –ø—Ä–æ–¥—ä–ª–∂–∏ –¥–∞ —Å–µ –∑–∞–Ω–∏–º–∞–≤–∞ —Å—ä—Å –∑–∞–¥–∞—á–∞—Ç–∞ –≤—ä–≤ —Ñ–æ–Ω–æ–≤ —Ä–µ–∂–∏–º –∏ –¥–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞ —Ä–µ—Å—É—Ä—Å–∞. –û—Ç —Å–≤–æ—è —Å—Ç—Ä–∞–Ω–∞ –∫–ª–∏–µ–Ω—Ç—ä—Ç –º–æ–∂–µ –¥–∞ –∏–∑–±–µ—Ä–µ –¥–∞ –ø—Ä–æ–≤–µ—Ä—è–≤–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ –Ω–∞ —Ç–æ–∑–∏ —Ä–µ—Å—É—Ä—Å, –∑–∞ –¥–∞ –ø–æ–ª—É—á–∏ —á–∞—Å—Ç–∏—á–Ω–∏ –∏–ª–∏ –ø—ä–ª–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ (–≤—ä–∑ –æ—Å–Ω–æ–≤–∞ –Ω–∞ —Ç–æ–≤–∞ –∫–∞–∫–≤–∏ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Ä–µ—Å—É—Ä—Å–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è —Å—ä—Ä–≤—ä—Ä—ä—Ç) –∏–ª–∏ –¥–∞ —Å–µ –∞–±–æ–Ω–∏—Ä–∞ –∑–∞ —Ä–µ—Å—É—Ä—Å–∞ –∑–∞ –∏–∑–≤–µ—Å—Ç–∏—è –∑–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è.

–ï–¥–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç—É–∫ –µ, —á–µ –ø—Ä–æ–≤–µ—Ä–∫–∞—Ç–∞ –Ω–∞ —Ä–µ—Å—É—Ä—Å–∏ –∏–ª–∏ –∞–±–æ–Ω–∏—Ä–∞–Ω–µ—Ç–æ –∑–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–∂–µ –¥–∞ –∫–æ–Ω—Å—É–º–∏—Ä–∞ —Ä–µ—Å—É—Ä—Å–∏ —Å –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –ø—Ä–∏ –º–∞—â–∞–±–∏—Ä–∞–Ω–µ. –ò–º–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç –æ–±—â–Ω–æ—Å—Ç—Ç–∞ (–≤–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ #992), –∫–æ–µ—Ç–æ –∏–∑—Å–ª–µ–¥–≤–∞ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç—Ç–∞ –∑–∞ –≤–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ —É–µ–± –∫—É–∫–∏ –∏–ª–∏ —Ç—Ä–∏–≥–µ—Ä–∏, –∫–æ–∏—Ç–æ —Å—ä—Ä–≤—ä—Ä—ä—Ç –º–æ–∂–µ –¥–∞ –∏–∑–≤–∏–∫–∞, –∑–∞ –¥–∞ —É–≤–µ–¥–æ–º–∏ –∫–ª–∏–µ–Ω—Ç–∞/—Ö–æ—Å—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –∑–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏.

| –§—É–Ω–∫—Ü–∏—è     | –ü—Ä–∏–º–µ—Ä –∑–∞ —É–ø–æ—Ç—Ä–µ–±–∞                                                                                                                                        | –ü–æ–¥–¥—Ä—ä–∂–∫–∞ –æ—Ç MCP                                                        |
| ----------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------- |
| –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç | –°—ä—Ä–≤—ä—Ä—ä—Ç —Å–µ —Å—Ä–∏–≤–∞ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –∑–∞–¥–∞—á–∞ –∑–∞ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –¥–∞–Ω–Ω–∏. –†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –∏ –Ω–∞–ø—Ä–µ–¥—ä–∫—ä—Ç –æ—Ü–µ–ª—è–≤–∞—Ç —Å–ª–µ–¥ —Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ, –∫–ª–∏–µ–Ω—Ç—ä—Ç –º–æ–∂–µ –¥–∞ –ø—Ä–æ–≤–µ—Ä–∏ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ –∏ –¥–∞ –ø—Ä–æ–¥—ä–ª–∂–∏ –æ—Ç –ø–æ—Å—Ç–æ—è–Ω–µ–Ω —Ä–µ—Å—É—Ä—Å. | ‚úÖ –í—Ä—ä–∑–∫–∏ –∫—ä–º —Ä–µ—Å—É—Ä—Å–∏ —Å –ø–æ—Å—Ç–æ—è–Ω–Ω–∞ –ø–∞–º–µ—Ç –∏ –∏–∑–≤–µ—Å—Ç–∏—è –∑–∞ —Å—Ç–∞—Ç—É—Å |

–î–Ω–µ—Å —á–µ—Å—Ç–æ —Å—Ä–µ—â–∞–Ω –º–æ–¥–µ–ª –µ –¥–∞ —Å–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ–π—Ç–æ —Å—ä–∑–¥–∞–≤–∞ —Ä–µ—Å—É—Ä—Å –∏ –≤–µ–¥–Ω–∞–≥–∞ –≤—Ä—ä—â–∞ –≤—Ä—ä–∑–∫–∞ –∫—ä–º —Ä–µ—Å—É—Ä—Å. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ä—Ç –º–æ–∂–µ –≤—ä–≤ —Ñ–æ–Ω–æ–≤ —Ä–µ–∂–∏–º –¥–∞ —Å–µ –∑–∞–Ω–∏–º–∞–≤–∞ —Å—ä—Å –∑–∞–¥–∞—á–∞—Ç–∞, –¥–∞ –∏–∑–¥–∞–≤–∞ –∏–∑–≤–µ—Å—Ç–∏—è –∑–∞ —Ä–µ—Å—É—Ä—Å–∏, –∫–æ–∏—Ç–æ —Å–ª—É–∂–∞—Ç –∫–∞—Ç–æ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫ –∏–ª–∏ –≤–∫–ª—é—á–≤–∞—Ç —á–∞—Å—Ç–∏—á–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏, –∏ –¥–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ –≤ —Ä–µ—Å—É—Ä—Å–∞ —Å–ø–æ—Ä–µ–¥ –Ω—É–∂–¥–∏—Ç–µ.

<div align="center" style="font-style: italic; font-size: 0.95em; margin-bottom: 0.5em;">
<strong>–§–∏–≥—É—Ä–∞ 3:</strong> –¢–∞–∑–∏ –¥–∏–∞–≥—Ä–∞–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–∞ –∫–∞–∫ MCP –∞–≥–µ–Ω—Ç–∏—Ç–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–∏ —Ä–µ—Å—É—Ä—Å–∏ –∏ –∏–∑–≤–µ—Å—Ç–∏—è –∑–∞ —Å—Ç–∞—Ç—É—Å, –∑–∞ –¥–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞—Ç, —á–µ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∏—Ç–µ –∑–∞–¥–∞—á–∏ –æ—Ü–µ–ª—è–≤–∞—Ç —Å–ª–µ–¥ —Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞, –ø–æ–∑–≤–æ–ª—è–≤–∞–π–∫–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∏—Ç–µ –¥–∞ –ø—Ä–æ–≤–µ—Ä—è–≤–∞—Ç –Ω–∞–ø—Ä–µ–¥—ä–∫–∞ –∏ –¥–∞ –∏–∑–≤–ª–∏—á–∞—Ç —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –¥–æ—Ä–∏ —Å–ª–µ–¥ –Ω–µ—É—Å–ø–µ—Ö–∏.
</div>

```mermaid
sequenceDiagram
    participant User
    participant Host as Host App<br/>(MCP Client)
    participant Server as MCP Server<br/>(Agent Tool)
    participant DB as Persistent Storage

    User->>Host: Start task
    Host->>Server: Call tool
    Server->>DB: Create resource + updates
    Server-->>Host: üîó Resource link

    Note over Server: üí• Server restart

    User->>Host: Check status
    Host->>Server: Get resource
    Server->>DB: Load state
    Server-->>Host: Current progress
    Server->>DB: Complete + notify
    Host-->>User: ‚úÖ Complete
```

### 4. –ú–Ω–æ–≥–æ—Ö–æ–¥–æ–≤–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

–ê–≥–µ–Ω—Ç–∏—Ç–µ —á–µ—Å—Ç–æ —Å–µ –Ω—É–∂–¥–∞—è—Ç –æ—Ç –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–µ–Ω –≤—Ö–æ–¥ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ:

- –ß–æ–≤–µ—à–∫–æ —É—Ç–æ—á–Ω–µ–Ω–∏–µ –∏–ª–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ
- AI –ø–æ–º–æ—â –∑–∞ —Å–ª–æ–∂–Ω–∏ —Ä–µ—à–µ–Ω–∏—è
- –î–∏–Ω–∞–º–∏—á–Ω–æ —Ä–µ–≥—É–ª–∏—Ä–∞–Ω–µ –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏

**–ü–æ–¥–¥—Ä—ä–∂–∫–∞ –æ—Ç MCP**: –ù–∞–ø—ä–ª–Ω–æ –ø–æ–¥–¥—ä—Ä–∂–∞–Ω–æ —á—Ä–µ–∑ —Å–µ–º–ø–ª–∏—Ä–∞–Ω–µ (–∑–∞ AI –≤—Ö–æ–¥) –∏ –µ–ª–∏—Ü–∏—Ç–∞—Ü–∏—è (–∑–∞ —á–æ–≤–µ—à–∫–∏ –≤—Ö–æ–¥).

| –§—É–Ω–∫—Ü–∏—è                  | –ü—Ä–∏–º–µ—Ä –∑–∞ —É–ø–æ—Ç—Ä–µ–±–∞                                                                                                                                     | –ü–æ–¥–¥—Ä—ä–∂–∫–∞ –æ—Ç MCP                                           |
| ------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------- |
| –ú–Ω–æ–≥–æ—Ö–æ–¥–æ–≤–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è | –ê–≥–µ–Ω—Ç–∞ –∑–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–∏—è –∏—Å–∫–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ –∑–∞ —Ü–µ–Ω–∞ –æ—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è, —Å–ª–µ–¥ —Ç–æ–≤–∞ –∏—Å–∫–∞ –æ—Ç AI –¥–∞ –æ–±–æ–±—â–∏ –¥–∞–Ω–Ω–∏—Ç–µ –∑–∞ –ø—ä—Ç—É–≤–∞–Ω–µ—Ç–æ –ø—Ä–µ–¥–∏ –¥–∞ –∑–∞–≤—ä—Ä—à–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ç–∞. | ‚úÖ –ï–ª–∏—Ü–∏—Ç–∞—Ü–∏—è –∑–∞ —á–æ–≤–µ—à–∫–∏ –≤—Ö–æ–¥, —Å–µ–º–ø–ª–∏—Ä–∞–Ω–µ –∑–∞ AI –≤—Ö–æ–¥ |

<div align="center" style="font-style: italic; font-size: 0.95em; margin-bottom: 0.5em;">
<strong>–§–∏–≥—É—Ä–∞ 4:</strong> –¢–∞–∑–∏ –¥–∏–∞–≥—Ä–∞–º–∞ –ø–æ–∫–∞–∑–≤–∞ –∫–∞–∫ MCP –∞–≥–µ–Ω—Ç–∏—Ç–µ –º–æ–≥–∞—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ –¥–∞ –∏–∑–∏—Å–∫–≤–∞—Ç —á–æ–≤–µ—à–∫–∏ –≤—Ö–æ–¥ –∏–ª–∏ –¥–∞ –ø–æ–∏—Å–∫–∞—Ç AI –ø–æ–º–æ—â –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ, –ø–æ–¥–¥—ä—Ä–∂–∞–π–∫–∏ —Å–ª–æ–∂–Ω–∏, –º–Ω–æ–≥–æ—Ö–æ–¥–æ–≤–∏ —Ä–∞–±–æ—Ç–Ω–∏ –ø–æ—Ç–æ—Ü–∏ –∫–∞—Ç–æ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏—è –∏ –¥–∏–Ω–∞–º–∏—á–Ω–æ –≤–∑–µ–º–∞–Ω–µ –Ω–∞ —Ä–µ—à–µ–Ω–∏—è.
</div>

```mermaid
sequenceDiagram
    participant User
    participant Host as Host App<br/>(MCP Client)
    participant Server as MCP Server<br/>(Agent Tool)

    User->>Host: Book flight
    Host->>Server: Call travel_agent

    Server->>Host: Elicitation: "Confirm $500?"
    Note over Host: Elicitation callback (if available)
    Host->>User: üí∞ Confirm price?
    User->>Host: "Yes"
    Host->>Server: Confirmed

    Server->>Host: Sampling: "Summarize data"
    Note over Host: AI callback (if available)
    Host->>Server: Report summary

    Server->>Host: ‚úÖ Flight booked
```

## –†–µ–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∏ –∞–≥–µ–Ω—Ç–∏ —Å MCP - –ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –∫–æ–¥–∞

–ö–∞—Ç–æ —á–∞—Å—Ç –æ—Ç —Ç–∞–∑–∏ —Å—Ç–∞—Ç–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è–º–µ [—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å –∫–æ–¥](https://github.com/victordibia/ai-tutorials/tree/main/MCP%20Agents), –∫–æ–π—Ç–æ —Å—ä–¥—ä—Ä–∂–∞ –ø—ä–ª–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∏ –∞–≥–µ–Ω—Ç–∏, –∏–∑–ø–æ–ª–∑–≤–∞–π–∫–∏ MCP Python SDK —Å—ä—Å StreamableHTTP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∑–∞ –≤—ä–∑–æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Å–µ—Å–∏—è –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ —Å—ä–æ–±—â–µ–Ω–∏—è. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ç–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–∞ –∫–∞–∫ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏—Ç–µ –Ω–∞ MCP –º–æ–≥–∞—Ç –¥–∞ –±—ä–¥–∞—Ç –∫–æ–º–±–∏–Ω–∏—Ä–∞–Ω–∏ –∑–∞ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ —Å–ª–æ–∂–Ω–∏ –∞–≥–µ–Ω—Ç–Ω–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è.

–°–ø–µ—Ü–∏–∞–ª–Ω–æ —Ä–µ–∞–ª–∏–∑–∏—Ä–∞–º–µ —Å—ä—Ä–≤—ä—Ä —Å –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω–∏ –∞–≥–µ–Ω—Ç–Ω–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:

- **–ê–≥–µ–Ω—Ç –∑–∞ –ø—ä—Ç—É–≤–∞–Ω–∏—è** - –°–∏–º—É–ª–∏—Ä–∞ —É—Å–ª—É–≥–∞ –∑–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è –Ω–∞ –ø—ä—Ç—É–≤–∞–Ω–∏—è —Å –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ —Ü–µ–Ω–∞ —á—Ä–µ–∑ –µ–ª–∏—Ü–∏—Ç–∞—Ü–∏—è
- **–ê–≥–µ–Ω—Ç –∑–∞ –∏–∑—Å–ª–µ–¥–≤–∞–Ω–∏—è** - –ò–∑–≤—ä—Ä—à–≤–∞ –∏–∑—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—Å–∫–∏ –∑–∞–¥–∞—á–∏ —Å AI-–∞—Å–∏—Å—Ç–∏—Ä–∞–Ω–∏ –æ–±–æ–±—â–µ–Ω–∏—è —á—Ä–µ–∑ —Å–µ–º–ø–ª–∏—Ä–∞–Ω–µ

–ò –¥–≤–∞—Ç–∞ –∞–≥–µ–Ω—Ç–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–∞—Ç –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞ –≤ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ, –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏—è –∏ –ø—ä–ª–Ω–∏ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞ –≤—ä–∑–æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Å–µ—Å–∏—è.

### –û—Å–Ω–æ–≤–Ω–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –∑–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

–°–ª–µ–¥–≤–∞—â–∏—Ç–µ —Å–µ–∫—Ü–∏–∏ –ø–æ–∫–∞–∑–≤–∞—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ç–∞ –Ω–∞ —Å—ä—Ä–≤—ä—Ä–Ω–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞ –Ω–∞ –∞–≥–µ–Ω—Ç–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞—Ç–∞ –Ω–∞ —Ö–æ—Å—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∑–∞ –≤—Å—è–∫–∞ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç:

#### –ü–æ—Ç–æ—á–Ω–æ –ø—Ä–µ–¥–∞–≤–∞–Ω–µ –∏ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞ - –°—Ç–∞—Ç—É—Å –Ω–∞ –∑–∞–¥–∞—á–∞—Ç–∞ –≤ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ

–ü–æ—Ç–æ—á–Ω–æ—Ç–æ –ø—Ä–µ–¥–∞–≤–∞–Ω–µ –ø–æ–∑–≤–æ–ª—è–≤–∞ –Ω–∞ –∞–≥–µ–Ω—Ç–∏—Ç–µ –¥–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è—Ç –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞ –≤ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∏ –∑–∞–¥–∞—á–∏, –∫–∞—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∏—Ä–∞—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏—Ç–µ –∑–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –∑–∞–¥–∞—á–∞—Ç–∞ –∏ –º–µ–∂–¥–∏–Ω–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞ (–∞–≥–µ–Ω—Ç—ä—Ç –∏–∑–ø—Ä–∞—â–∞ –∏–∑–≤–µ—Å—Ç–∏—è –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫):**

```python
# From server/server.py - Travel agent sending progress updates
for i, step in enumerate(steps):
    await ctx.session.send_progress_notification(
        progress_token=ctx.request_id,
        progress=i * 25,
        total=100,
        message=step,
        related_request_id=str(ctx.request_id)
    )
    await anyio.sleep(2)  # Simulate work

# Alternative: Log messages for detailed step-by-step updates
await ctx.session.send_log_message(
    level="info",
    data=f"Processing step {current_step}/{steps} ({progress_percent}%)",
    logger="long_running_agent",
    related_request_id=ctx.request_id,
)
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ (—Ö–æ—Å—Ç—ä—Ç –ø–æ–ª—É—á–∞–≤–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫):**

```python
# From client/client.py - Client handling real-time notifications
async def message_handler(message) -> None:
    if isinstance(message, types.ServerNotification):
        if isinstance(message.root, types.LoggingMessageNotification):
            console.print(f"üì° [dim]{message.root.params.data}[/dim]")
        elif isinstance(message.root, types.ProgressNotification):
            progress = message.root.params
            console.print(f"üîÑ [yellow]{progress.message} ({progress.progress}/{progress.total})[/yellow]")

# Register message handler when creating session
async with ClientSession(
    read_stream, write_stream,
    message_handler=message_handler
) as session:
```

#### –ï–ª–∏—Ü–∏—Ç–∞—Ü–∏—è - –ò—Å–∫–∞–Ω–µ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –≤—Ö–æ–¥

–ï–ª–∏—Ü–∏—Ç–∞—Ü–∏—è—Ç–∞ –ø–æ–∑–≤–æ–ª—è–≤–∞ –Ω–∞ –∞–≥–µ–Ω—Ç–∏—Ç–µ –¥–∞ –∏–∑–∏—Å–∫–≤–∞—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –≤—Ö–æ–¥ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ. –¢–æ–≤–∞ –µ –æ—Ç —Å—ä—â–µ—Å—Ç–≤–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏—è, —É—Ç–æ—á–Ω–µ–Ω–∏—è –∏–ª–∏ –æ–¥–æ–±—Ä–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∏ –∑–∞–¥–∞—á–∏.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞ (–∞–≥–µ–Ω—Ç—ä—Ç –∏–∑–∏—Å–∫–≤–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ):**

```python
# From server/server.py - Travel agent requesting price confirmation
elicit_result = await ctx.session.elicit(
    message=f"Please confirm the estimated price of $1200 for your trip to {destination}",
    requestedSchema=PriceConfirmationSchema.model_json_schema(),
    related_request_id=ctx.request_id,
)

if elicit_result and elicit_result.action == "accept":
    # Continue with booking
    logger.info(f"User confirmed price: {elicit_result.content}")
elif elicit_result and elicit_result.action == "decline":
    # Cancel the booking
    booking_cancelled = True
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ (—Ö–æ—Å—Ç—ä—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è –æ–±—Ä–∞—Ç–Ω–∞ –≤—Ä—ä–∑–∫–∞ –∑–∞ –µ–ª–∏—Ü–∏—Ç–∞—Ü–∏—è):**

```python
# From client/client.py - Client handling elicitation requests
async def elicitation_callback(context, params):
    console.print(f"üí¨ Server is asking for confirmation:")
    console.print(f"   {params.message}")

    response = console.input("Do you accept? (y/n): ").strip().lower()

    if response in ['y', 'yes']:
        return types.ElicitResult(
            action="accept",
            content={"confirm": True, "notes": "Confirmed by user"}
        )
    else:
        return types.ElicitResult(
            action="decline",
            content={"confirm": False, "notes": "Declined by user"}
        )

# Register the callback when creating the session
async with ClientSession(
    read_stream, write_stream,
    elicitation_callback=elicitation_callback
) as session:
```

#### –°–µ–º–ø–ª–∏—Ä–∞–Ω–µ - –ò—Å–∫–∞–Ω–µ –∑–∞ AI –ø–æ–º–æ—â

–°–µ–º–ø–ª–∏—Ä–∞–Ω–µ—Ç–æ –ø–æ–∑–≤–æ–ª—è–≤–∞ –Ω–∞ –∞–≥–µ–Ω—Ç–∏—Ç–µ –¥–∞ –∏–∑–∏—Å–∫–≤–∞—Ç –ø–æ–º–æ—â –æ—Ç LLM –∑–∞ —Å–ª–æ–∂–Ω–∏ —Ä–µ—à–µ–Ω–∏—è –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ. –¢–æ–≤–∞ –ø–æ–∑–≤–æ–ª—è–≤–∞ —Ö–∏–±—Ä–∏–¥–Ω–∏ —á–æ–≤–µ—à–∫–æ-AI —Ä–∞–±–æ—Ç–Ω–∏ –ø–æ—Ç–æ—Ü–∏.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞ (–∞–≥–µ–Ω—Ç—ä—Ç –∏–∑–∏—Å–∫–≤–∞ AI –ø–æ–º–æ—â):**

```python
# From server/server.py - Research agent requesting AI summary
sampling_result = await ctx.session.create_message(
    messages=[
        SamplingMessage(
            role="user",
            content=TextContent(type="text", text=f"Please summarize the key findings for research on: {topic}")
        )
    ],
    max_tokens=100,
    related_request_id=ctx.request_id,
)

if sampling_result and sampling_result.content:
    if sampling_result.content.type == "text":
        sampling_summary = sampling_result.content.text
        logger.info(f"Received sampling summary: {sampling_summary}")
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ (—Ö–æ—Å—Ç—ä—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è –æ–±—Ä–∞—Ç–Ω–∞ –≤—Ä—ä–∑–∫–∞ –∑–∞ —Å–µ–º–ø–ª–∏—Ä–∞–Ω–µ):**

```python
# From client/client.py - Client handling sampling requests
async def sampling_callback(context, params):
    message_text = params.messages[0].content.text if params.messages else 'No message'
    console.print(f"üß† Server requested sampling: {message_text}")

    # In a real application, this could call an LLM API
    # For demo purposes, we provide a mock response
    mock_response = "Based on current research, MCP has evolved significantly..."

    return types.CreateMessageResult(
        role="assistant",
        content=types.TextContent(type="text", text=mock_response),
        model="interactive-client",
        stopReason="endTurn"
    )

# Register the callback when creating the session
async with ClientSession(
    read_stream, write_stream,
    sampling_callback=sampling_callback,
    elicitation_callback=elicitation_callback
) as session:
```

#### –í—ä–∑–æ–±–Ω–æ–≤—è–µ–º–æ—Å—Ç - –ù–µ–ø—Ä–µ–∫—ä—Å–Ω–∞—Ç–æ—Å—Ç –Ω–∞ —Å–µ—Å–∏—è—Ç–∞ –ø—Ä–∏ –ø—Ä–µ–∫—ä—Å–≤–∞–Ω–∏—è

–í—ä–∑–æ–±–Ω–æ–≤—è–µ–º–æ—Å—Ç—Ç–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞, —á–µ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∏—Ç–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –∞–≥–µ–Ω—Ç–∞ –º–æ–≥–∞—Ç –¥–∞ –æ—Ü–µ–ª–µ—è—Ç –ø—Ä–∏ –ø—Ä–µ–∫—ä—Å–≤–∞–Ω–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∏ –¥–∞ –ø—Ä–æ–¥—ä–ª–∂–∞—Ç –±–µ–∑–ø—Ä–æ–±–ª–µ–º–Ω–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å–≤—ä—Ä–∑–≤–∞–Ω–µ. –¢–æ–≤–∞ —Å–µ —Ä–µ–∞–ª–∏–∑–∏—Ä–∞ —á—Ä–µ–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ —Å—ä–±–∏—Ç–∏—è –∏ —Ç–æ–∫–µ–Ω–∏ –∑–∞ –≤—ä–∑–æ–±–Ω–æ–≤—è–≤–∞–Ω–µ.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞ —Å—ä–±–∏—Ç–∏—è (—Å—ä—Ä–≤—ä—Ä—ä—Ç —Å—ä—Ö—Ä–∞–Ω—è–≤–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ –Ω–∞ —Å–µ—Å–∏—è—Ç–∞):**

```python
# From server/event_store.py - Simple in-memory event store
class SimpleEventStore(EventStore):
    def __init__(self):
        self._events: list[tuple[StreamId, EventId, JSONRPCMessage]] = []
        self._event_id_counter = 0

    async def store_event(self, stream_id: StreamId, message: JSONRPCMessage) -> EventId:
        """Store an event and return its ID."""
        self._event_id_counter += 1
        event_id = str(self._event_id_counter)
        self._events.append((stream_id, event_id, message))
        return event_id

    async def replay_events_after(self, last_event_id: EventId, send_callback: EventCallback) -> StreamId | None:
        """Replay events after the specified ID for resumption."""
        # Find events after the last known event and replay them
        for _, event_id, message in self._events[start_index:]:
            await send_callback(EventMessage(message, event_id))

# From server/server.py - Passing event store to session manager
def create_server_app(event_store: Optional[EventStore] = None) -> Starlette:
    server = ResumableServer()

    # Create session manager with event store for resumption
    session_manager = StreamableHTTPSessionManager(
        app=server,
        event_store=event_store,  # Event store enables session resumption
        json_response=False,
        security_settings=security_settings,
    )

    return Starlette(routes=[Mount("/mcp", app=session_manager.handle_request)])

# Usage: Initialize with event store
event_store = SimpleEventStore()
app = create_server_app(event_store)
```

**–ú–µ—Ç–∞–¥–∞–Ω–Ω–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ —Å —Ç–æ–∫–µ–Ω –∑–∞ –≤—ä–∑–æ–±–Ω–æ–≤—è–≤–∞–Ω–µ (–∫–ª–∏–µ–Ω—Ç—ä—Ç —Å–µ —Å–≤—ä—Ä–∑–≤–∞ –æ—Ç–Ω–æ–≤–æ, –∏–∑–ø–æ–ª–∑–≤–∞–π–∫–∏ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ):**

```python
# From client/client.py - Client resumption with metadata
if existing_tokens and existing_tokens.get("resumption_token"):
    # Use existing resumption token to continue where we left off
    metadata = ClientMessageMetadata(
        resumption_token=existing_tokens["resumption_token"],
    )
else:
    # Create callback to save resumption token when received
    def enhanced_callback(token: str):
        protocol_version = getattr(session, 'protocol_version', None)
        token_manager.save_tokens(session_id, token, protocol_version, command, args)

    metadata = ClientMessageMetadata(
        on_resumption_token_update=enhanced_callback,
    )

# Send request with resumption metadata
result = await session.send_request(
    types.ClientRequest(
        types.CallToolRequest(
            method="tools/call",
            params=types.CallToolRequestParams(name=command, arguments=args)
        )
    ),
    types.CallToolResult,
    metadata=metadata,
)
```

–•–æ—Å—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –ø–æ–¥–¥—ä—Ä–∂–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∏ –Ω–∞ —Å–µ—Å–∏–∏ –∏ —Ç–æ–∫–µ–Ω–∏ –∑–∞ –≤—ä–∑–æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –ª–æ–∫–∞–ª–Ω–æ, –ø–æ–∑–≤–æ–ª—è–≤–∞–π–∫–∏ –º—É –¥–∞ —Å–µ —Å–≤—ä—Ä–∂–µ –æ—Ç–Ω–æ–≤–æ –∫—ä–º —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏ —Å–µ—Å–∏–∏ –±–µ–∑ –∑–∞–≥—É–±–∞ –Ω–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫ –∏–ª–∏ —Å—ä—Å—Ç–æ—è–Ω–∏–µ.

### –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –Ω–∞ –∫–æ–¥–∞

<div align="center" style="font-style: italic; font-size: 0.95em; margin-bottom: 0.5em;">
<strong>–§–∏–≥—É—Ä–∞ 5:</strong> –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞ –∞–≥–µ–Ω—Ç–∏, –±–∞–∑–∏—Ä–∞–Ω–∞ –Ω–∞ MCP
</div>

```mermaid
graph LR
    User([User]) -->|"Task"| Host["Host<br/>(MCP Client)"]
    Host -->|list tools| Server[MCP Server]
    Server -->|Exposes| AgentsTools[Agents as Tools]
    AgentsTools -->|Task| AgentA[Travel Agent]
    AgentsTools -->|Task| AgentB[Research Agent]

    Host -->|Monitors| StateUpdates[Progress & State Updates]
    Server -->|Publishes| StateUpdates

    class User user;
    class AgentA,AgentB agent;
    class Host,Server,StateUpdates core;
```

**–û—Å–Ω–æ–≤–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ:**

- **`server/server.py`** - MCP —Å—ä—Ä–≤—ä—Ä —Å –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç –∑–∞ –≤—ä–∑–æ–±–Ω–æ–≤—è–≤–∞–Ω–µ, –≤–∫–ª—é—á–≤–∞—â –∞–≥–µ–Ω—Ç–∏ –∑–∞ –ø—ä—Ç—É–≤–∞–Ω–∏—è –∏ –∏–∑—Å–ª–µ–¥–≤–∞–Ω–∏—è, –∫–æ–∏—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–∞—Ç –µ–ª–∏—Ü–∏—Ç–∞—Ü–∏—è, —Å–µ–º–ø–ª–∏—Ä–∞–Ω–µ –∏ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫
- **`client/client.py`** - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ —Ö–æ—Å—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø–æ–¥–¥—Ä—ä–∂–∫–∞ –∑–∞ –≤—ä–∑–æ–±–Ω–æ–≤—è–≤–∞–Ω–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –æ–±—Ä–∞—Ç–Ω–∏ –≤—Ä—ä–∑–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ç–æ–∫–µ–Ω–∏
- **`server/event_store.py`** - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞ —Å—ä–±–∏—Ç–∏—è, –ø–æ–∑–≤–æ–ª—è–≤–∞—â–æ –≤—ä–∑–æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Å–µ—Å–∏—è –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ —Å—ä–æ–±—â–µ–Ω–∏—è

## –†–∞–∑—à–∏—Ä—è–≤–∞–Ω–µ –∫—ä–º –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∞–≥–µ–Ω—Ç–∏ —Å MCP

–ì–æ—Ä–Ω–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–∂–µ –¥–∞ –±—ä–¥–µ —Ä–∞–∑—à–∏—Ä–µ–Ω–∞ –∫—ä–º —Å–∏—Å—Ç–µ–º–∏ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∞–≥–µ–Ω—Ç–∏ —á—Ä–µ–∑ –ø–æ–¥–æ–±—Ä—è–≤–∞–Ω–µ –Ω–∞ –∏–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–æ—Å—Ç—Ç–∞ –∏ –æ–±—Ö–≤–∞—Ç–∞ –Ω–∞ —Ö–æ—Å—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ:

- **–ò–Ω—Ç–µ–ª

**–û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç**:  
–¢–æ–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç –µ –ø—Ä–µ–≤–µ–¥–µ–Ω —Å –ø–æ–º–æ—â—Ç–∞ –Ω–∞ AI —É—Å–ª—É–≥–∞ –∑–∞ –ø—Ä–µ–≤–æ–¥ [Co-op Translator](https://github.com/Azure/co-op-translator). –í—ä–ø—Ä–µ–∫–∏ —á–µ —Å–µ —Å—Ç—Ä–µ–º–∏–º –∫—ä–º —Ç–æ—á–Ω–æ—Å—Ç, –º–æ–ª—è, –∏–º–∞–π—Ç–µ –ø—Ä–µ–¥–≤–∏–¥, —á–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–∞–Ω–∏—Ç–µ –ø—Ä–µ–≤–æ–¥–∏ –º–æ–∂–µ –¥–∞ —Å—ä–¥—ä—Ä–∂–∞—Ç –≥—Ä–µ—à–∫–∏ –∏–ª–∏ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏. –û—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—è—Ç –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ –Ω–µ–≥–æ–≤–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª–µ–Ω –µ–∑–∏–∫ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ —Å—á–∏—Ç–∞ –∑–∞ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–µ–Ω –∏–∑—Ç–æ—á–Ω–∏–∫. –ó–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–µ –ø—Ä–µ–ø–æ—Ä—ä—á–≤–∞ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–µ–Ω —á–æ–≤–µ—à–∫–∏ –ø—Ä–µ–≤–æ–¥. –ù–∏–µ –Ω–µ –Ω–æ—Å–∏–º –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç –∑–∞ –∫–∞–∫–≤–∏—Ç–æ –∏ –¥–∞ –µ –Ω–µ–¥–æ—Ä–∞–∑—É–º–µ–Ω–∏—è –∏–ª–∏ –ø–æ–≥—Ä–µ—à–Ω–∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏, –ø—Ä–æ–∏–∑—Ç–∏—á–∞—â–∏ –æ—Ç –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ—Ç–æ –Ω–∞ —Ç–æ–∑–∏ –ø—Ä–µ–≤–æ–¥.